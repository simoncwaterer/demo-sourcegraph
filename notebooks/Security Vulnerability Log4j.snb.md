#Fixing code vulnerabilities


##Discovery Questions

1. How many resources are dedicated to security vulnerability scanning?
2. What is the current process for handling vulnerabilities?
3. How long does the process usually take?
4. How often do security searches need to be run?
5. Are you able to monitor your codebase to ensure that sensitive data and tokens are not exposed in source code?
6. How do you track the deprecation of vulnerable packages?
7. What tools do you currently use with respect to detecting security issues in your code?

##Sourcegraph Differentiation - traps

1. Find vulnerabilities in your source code and build tools as opposed to just in OSS/third party libraries/packages.
2. Generate alerts to warn if identified vulnerabilities are added
3. Create charts to monitor migration away from known vulnerabilities
4. Automate fixes - update library version etc.

##Talk Track

One of the use cases that our clients use Sourcegraph is to detect and manage security vulnerabilities within their code. Be that packages or libraries with identified vulnerabilities or where developers have put tokens or secrets in their code during development. With Sourcegraph we can find vulnerabilities in the source code, automatically fix them and also create dashboards to enable dev teams to monitor progress.

* Could you tell us what is your current approach to handling security issues? 
* Is it largely a manual process? 
* Do you have a view regarding how long the process takes from start to finish? 
* How often do you have to check for security issues? 
* Are you able to monitor progress in some way?

Would it be useful to show a example of how we can identify vulnerabilities in your code?

Let us use the Log4j logging package as an example. The Log4j vulnerability allows remote code execution. It was ientified very recently as I am sure you are aware. (First idenitified in December 2021) The bug affects versions between 2.0 and 2.14.1.

Using Sourcegraph we can -

* Find everywhere log4j is used across all your code
* Automatically fix the issue in your code
* And also track the progress of applying fixes for log4j

So how can we find where in your code you are using Log4j? Well the best place to start is the build tools you are using. Let us assume that we are using Gradle. So lets search in Gradle for log4j library.

Lets run a query on the public instance of Sourcegraph. We have over 2M repos indexed at [sourcegraph.com](sourcegraph.com). 

We can limit the scope of the search to only gradle artifacts using a lang filter. And we can search for the log4j package.

```sourcegraph
lang:gradle org\.apache\.logging\.log4j patterntype:regexp count:all
```
We can then refine the regex expression so that we only find direct dependencies on vulnerable log4j versions.

```sourcegraph
lang:gradle org\.apache\.logging\.log4j['"] 2\.(0|1|2|3|4|5|6|7|8|9|10|11|12|13|14)(\.[0-9]+)
 patterntype:regexp count:all
```

So we now have matches in our gradle files. If are only interested in finding the effected repos we can use the select filter.

```sourcegraph
lang:gradle org\.apache\.logging\.log4j['"] 2\.(0|1|2|3|4|5|6|7|8|9|10|11|12|13|14)(\.[0-9]+)
 patterntype:regexp select:repo count:all
```

We can share this query with other teams, or export the results to a csv file and we can run the query via a GraphQL API. 

How does this compare to how you might go about this today?